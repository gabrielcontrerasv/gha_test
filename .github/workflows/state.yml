name: Workflow JSONPlaceholder

on:
  push:
    branches:
      - main

env:
  STATE_BUCKET: statebenchmark

jobs:
  call-jsonplaceholder:
    runs-on: ubuntu-latest
    steps:
      - name: Set initial state
        run: |
            echo "{\"status\": \"${{ job.status }}\"}" > json_placeholder.json
      - name: Call JSONPlaceholder
        run: |
          curl https://jsonplaceholder.typicode.com/todos > response.json
          echo "{\"status\": \"$(cat response.json | jq '.title')\"}" > state_placeholder.json
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1
      - name: Save state to S3
        run: aws s3 cp state_placeholder.json s3://${{ env.STATE_BUCKET }}/state_placeholder.json

  call-githubactions:
    runs-on: ubuntu-latest
    steps:
      - name: Set initial state
        run: |
          echo "{\"status\": \"starting\"}" > state_githubactions.json
      - name: Call GitHub Actions
        run: |
          echo "{\"status\": \"${{ job.status }}\"}" > state_githubactions.json
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESSKEY }}
          aws-secret-access-key: ${{ secrets.AWS_SECRETACCESSKEY }}
          aws-region: us-east-1
      - name: Save state to S3
        run: aws s3 cp state_githubactions.json s3://${{ env.STATE_BUCKET }}/state_githubactions.json

